# 生产管理功能开发文档

## 1. 功能概述

生产管理模块用于管理注塑生产订单、生产计划和生产记录，实现生产全流程跟踪和产量统计。

## 2. 功能需求

### 2.1 生产订单管理
- 订单列表查询（分页）
- 订单新增、编辑、删除
- 订单状态：待生产、生产中、已完成、已取消
- 订单编号自动生成（如：ORDER20240115001）
- 订单信息：客户、产品、数量、交期等

### 2.2 生产计划管理
- 计划列表查询
- 计划制定（关联订单）
- 计划状态：待执行、执行中、已完成
- 计划信息：设备、模具、人员、计划开始/结束时间

### 2.3 生产记录管理
- 生产记录录入
- 记录列表查询
- 记录信息：订单号、计划号、设备、模具、操作员、产量、不良品数量、生产时间等

### 2.4 产量统计
- 按日期统计
- 按订单统计
- 按设备统计
- 按产品统计
- 支持多维度查询和导出

## 3. 数据库设计

### 3.1 生产订单表（production_order）

```sql
CREATE TABLE `production_order` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `order_no` varchar(50) NOT NULL COMMENT '订单编号',
  `customer_name` varchar(100) DEFAULT NULL COMMENT '客户名称',
  `product_name` varchar(100) NOT NULL COMMENT '产品名称',
  `product_code` varchar(50) DEFAULT NULL COMMENT '产品编码',
  `quantity` int NOT NULL COMMENT '订单数量',
  `completed_quantity` int DEFAULT 0 COMMENT '已完成数量',
  `delivery_date` date DEFAULT NULL COMMENT '交期',
  `status` tinyint DEFAULT 0 COMMENT '状态：0-待生产，1-生产中，2-已完成，3-已取消',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='生产订单表';
```

### 3.2 生产计划表（production_plan）

```sql
CREATE TABLE `production_plan` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `plan_no` varchar(50) NOT NULL COMMENT '计划编号',
  `order_id` bigint NOT NULL COMMENT '订单ID',
  `equipment_id` bigint DEFAULT NULL COMMENT '设备ID',
  `mold_id` bigint DEFAULT NULL COMMENT '模具ID',
  `operator_id` bigint DEFAULT NULL COMMENT '操作员ID',
  `plan_start_time` datetime DEFAULT NULL COMMENT '计划开始时间',
  `plan_end_time` datetime DEFAULT NULL COMMENT '计划结束时间',
  `plan_quantity` int NOT NULL COMMENT '计划数量',
  `status` tinyint DEFAULT 0 COMMENT '状态：0-待执行，1-执行中，2-已完成',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_plan_no` (`plan_no`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='生产计划表';
```

### 3.3 生产记录表（production_record）

```sql
CREATE TABLE `production_record` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `record_no` varchar(50) NOT NULL COMMENT '记录编号',
  `order_id` bigint NOT NULL COMMENT '订单ID',
  `plan_id` bigint DEFAULT NULL COMMENT '计划ID',
  `equipment_id` bigint DEFAULT NULL COMMENT '设备ID',
  `mold_id` bigint DEFAULT NULL COMMENT '模具ID',
  `operator_id` bigint DEFAULT NULL COMMENT '操作员ID',
  `production_date` date NOT NULL COMMENT '生产日期',
  `start_time` datetime DEFAULT NULL COMMENT '开始时间',
  `end_time` datetime DEFAULT NULL COMMENT '结束时间',
  `quantity` int NOT NULL COMMENT '产量',
  `defect_quantity` int DEFAULT 0 COMMENT '不良品数量',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_record_no` (`record_no`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_production_date` (`production_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='生产记录表';
```

## 4. 开发要点

### 4.1 编号生成规则
- 订单编号：ORDER + 日期（YYYYMMDD）+ 序号（3位）
- 计划编号：PLAN + 日期 + 序号
- 记录编号：RECORD + 日期 + 序号

### 4.2 状态流转
- 订单：待生产 → 生产中 → 已完成
- 计划：待执行 → 执行中 → 已完成
- 记录录入后自动更新订单和计划的完成数量

### 4.3 统计功能
- 使用SQL聚合函数统计
- 支持按日期、订单、设备、产品等维度统计
- 提供图表展示（可选）

## 5. 注意事项

1. 订单编号、计划编号、记录编号必须唯一
2. 生产记录录入后需要更新订单和计划的完成数量
3. 订单完成数量达到订单数量时，订单状态自动变为已完成
4. 删除使用逻辑删除
5. 生产记录关联订单，删除订单前检查是否有生产记录
