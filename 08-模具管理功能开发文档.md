# 模具管理功能开发文档

## 1. 功能概述

模具管理模块用于管理注塑生产中的模具信息，包括模具基本信息、使用记录、维护保养记录、寿命管理等。

## 2. 功能需求

### 2.1 模具基本信息管理
- 模具列表查询（分页）
- 模具新增、编辑、删除
- 模具信息：模具编号、模具名称、模具类型、适用产品、制造商、购买日期、状态等
- 模具状态：正常、维修中、报废

### 2.2 模具使用记录
- 使用记录录入
- 使用记录查询
- 记录信息：模具编号、使用日期、使用设备、生产订单、使用次数等

### 2.3 模具维护保养记录
- 维护记录录入
- 维护记录查询
- 维护信息：维护日期、维护类型、维护内容、维护人员、费用等

### 2.4 模具寿命管理
- 记录模具总使用次数
- 记录模具预计寿命
- 寿命预警（接近寿命时提醒）

## 3. 数据库设计

### 3.1 模具表（mold）

```sql
CREATE TABLE `mold` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `mold_no` varchar(50) NOT NULL COMMENT '模具编号',
  `mold_name` varchar(100) NOT NULL COMMENT '模具名称',
  `mold_type` varchar(50) DEFAULT NULL COMMENT '模具类型',
  `product_name` varchar(100) DEFAULT NULL COMMENT '适用产品',
  `manufacturer` varchar(100) DEFAULT NULL COMMENT '制造商',
  `purchase_date` date DEFAULT NULL COMMENT '购买日期',
  `expected_life` int DEFAULT NULL COMMENT '预计寿命（次数）',
  `used_count` int DEFAULT 0 COMMENT '已使用次数',
  `status` tinyint DEFAULT 1 COMMENT '状态：0-报废，1-正常，2-维修中',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_mold_no` (`mold_no`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='模具表';
```

### 3.2 模具使用记录表（mold_usage）

```sql
CREATE TABLE `mold_usage` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `mold_id` bigint NOT NULL COMMENT '模具ID',
  `usage_date` date NOT NULL COMMENT '使用日期',
  `equipment_id` bigint DEFAULT NULL COMMENT '设备ID',
  `order_id` bigint DEFAULT NULL COMMENT '订单ID',
  `usage_count` int DEFAULT 1 COMMENT '使用次数',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_mold_id` (`mold_id`),
  KEY `idx_usage_date` (`usage_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='模具使用记录表';
```

### 3.3 模具维护记录表（mold_maintenance）

```sql
CREATE TABLE `mold_maintenance` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `mold_id` bigint NOT NULL COMMENT '模具ID',
  `maintenance_date` date NOT NULL COMMENT '维护日期',
  `maintenance_type` varchar(50) DEFAULT NULL COMMENT '维护类型',
  `maintenance_content` varchar(500) DEFAULT NULL COMMENT '维护内容',
  `maintainer_name` varchar(50) DEFAULT NULL COMMENT '维护人员',
  `cost` decimal(10,2) DEFAULT NULL COMMENT '维护费用',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_mold_id` (`mold_id`),
  KEY `idx_maintenance_date` (`maintenance_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='模具维护记录表';
```

## 4. 开发要点

### 4.1 使用次数统计
- 每次使用记录录入时，自动更新模具的已使用次数
- 使用次数达到预计寿命的80%时，进行预警

### 4.2 状态管理
- 模具状态：0-报废，1-正常，2-维修中
- 维修中时，不能分配给生产计划

### 4.3 关联关系
- 模具使用记录关联生产订单
- 模具使用记录关联设备
- 删除模具前检查是否有使用记录

## 5. 注意事项

1. 模具编号必须唯一
2. 使用记录录入后需要更新模具的已使用次数
3. 删除使用逻辑删除
4. 模具寿命预警功能需要在前端展示
5. 维修中的模具不能分配给生产计划
