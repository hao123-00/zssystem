# 物料管理功能开发文档

## 1. 功能概述

物料管理模块用于管理注塑生产中的物料信息，包括物料基本信息、入库管理、出库管理、库存查询统计、库存预警等。

## 2. 功能需求

### 2.1 物料基本信息管理
- 物料列表查询（分页）
- 物料新增、编辑、删除
- 物料信息：物料编号、物料名称、物料类型、规格、单位、最低库存、当前库存等

### 2.2 物料入库管理
- 入库单录入
- 入库单查询
- 入库信息：物料编号、入库数量、入库日期、供应商、批次号、入库人员等
- 入库后自动更新库存

### 2.3 物料出库管理
- 出库单录入
- 出库单查询
- 出库信息：物料编号、出库数量、出库日期、领用部门、领用人员、用途等
- 出库后自动更新库存
- 先进先出（FIFO）原则

### 2.4 库存查询统计
- 当前库存查询
- 库存变动记录查询
- 按物料类型统计
- 库存报表导出

### 2.5 库存预警
- 当库存低于最低库存时，进行预警
- 预警列表展示
- 预警通知（可选）

## 3. 数据库设计

### 3.1 物料表（material）

```sql
CREATE TABLE `material` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `material_no` varchar(50) NOT NULL COMMENT '物料编号',
  `material_name` varchar(100) NOT NULL COMMENT '物料名称',
  `material_type` varchar(50) DEFAULT NULL COMMENT '物料类型',
  `specification` varchar(100) DEFAULT NULL COMMENT '规格',
  `unit` varchar(20) DEFAULT NULL COMMENT '单位',
  `min_stock` decimal(10,2) DEFAULT 0 COMMENT '最低库存',
  `current_stock` decimal(10,2) DEFAULT 0 COMMENT '当前库存',
  `status` tinyint DEFAULT 1 COMMENT '状态：0-停用，1-启用',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_material_no` (`material_no`),
  KEY `idx_material_type` (`material_type`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='物料表';
```

### 3.2 物料入库表（material_inbound）

```sql
CREATE TABLE `material_inbound` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `inbound_no` varchar(50) NOT NULL COMMENT '入库单号',
  `material_id` bigint NOT NULL COMMENT '物料ID',
  `material_no` varchar(50) NOT NULL COMMENT '物料编号',
  `material_name` varchar(100) NOT NULL COMMENT '物料名称',
  `quantity` decimal(10,2) NOT NULL COMMENT '入库数量',
  `inbound_date` date NOT NULL COMMENT '入库日期',
  `supplier` varchar(100) DEFAULT NULL COMMENT '供应商',
  `batch_no` varchar(50) DEFAULT NULL COMMENT '批次号',
  `inbound_person` varchar(50) DEFAULT NULL COMMENT '入库人员',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_inbound_no` (`inbound_no`),
  KEY `idx_material_id` (`material_id`),
  KEY `idx_inbound_date` (`inbound_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='物料入库表';
```

### 3.3 物料出库表（material_outbound）

```sql
CREATE TABLE `material_outbound` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `outbound_no` varchar(50) NOT NULL COMMENT '出库单号',
  `material_id` bigint NOT NULL COMMENT '物料ID',
  `material_no` varchar(50) NOT NULL COMMENT '物料编号',
  `material_name` varchar(100) NOT NULL COMMENT '物料名称',
  `quantity` decimal(10,2) NOT NULL COMMENT '出库数量',
  `outbound_date` date NOT NULL COMMENT '出库日期',
  `department` varchar(50) DEFAULT NULL COMMENT '领用部门',
  `recipient` varchar(50) DEFAULT NULL COMMENT '领用人员',
  `purpose` varchar(200) DEFAULT NULL COMMENT '用途',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_outbound_no` (`outbound_no`),
  KEY `idx_material_id` (`material_id`),
  KEY `idx_outbound_date` (`outbound_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='物料出库表';
```

### 3.4 物料库存明细表（material_stock_detail）

```sql
CREATE TABLE `material_stock_detail` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `material_id` bigint NOT NULL COMMENT '物料ID',
  `batch_no` varchar(50) DEFAULT NULL COMMENT '批次号',
  `quantity` decimal(10,2) NOT NULL COMMENT '数量',
  `inbound_date` date NOT NULL COMMENT '入库日期',
  `status` tinyint DEFAULT 1 COMMENT '状态：0-已出库，1-在库',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_material_id` (`material_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='物料库存明细表（用于FIFO）';
```

## 4. 开发要点

### 4.1 库存更新
- 入库时：当前库存 += 入库数量
- 出库时：当前库存 -= 出库数量，需要检查库存是否充足

### 4.2 先进先出（FIFO）
- 使用material_stock_detail表记录每个批次的库存
- 出库时，按照入库日期从早到晚的顺序出库
- 更新库存明细表的状态

### 4.3 库存预警
- 定时检查当前库存是否低于最低库存
- 预警列表展示低于最低库存的物料
- 可以设置预警阈值（如：最低库存的1.2倍）

### 4.4 编号生成
- 入库单号：IN + 日期 + 序号
- 出库单号：OUT + 日期 + 序号

## 5. 注意事项

1. 物料编号必须唯一
2. 入库和出库后需要同步更新当前库存
3. 出库前需要检查库存是否充足
4. 删除使用逻辑删除
5. 库存明细表用于实现FIFO，需要维护批次信息
6. 库存预警功能需要定期检查或实时检查
7. 支持库存报表导出功能
