# 现场5S管理功能开发文档

## 1. 功能概述

现场5S管理模块用于管理注塑车间的5S检查工作，包括5S检查记录、整改任务管理、整改进度跟踪、评分统计等。

## 2. 功能需求

### 2.1 5S检查记录
- 检查记录录入
- 检查记录查询（分页）
- 检查信息：检查日期、检查区域、检查人员、5S各项评分、总分、问题描述等
- 5S项目：整理、整顿、清扫、清洁、素养（每项满分20分，总分100分）

### 2.2 整改任务管理
- 整改任务创建（从检查记录中生成）
- 整改任务查询
- 整改信息：任务编号、问题描述、责任部门、责任人、整改期限、整改状态等

### 2.3 整改进度跟踪
- 整改状态：待整改、整改中、待验证、已完成
- 整改进度更新
- 整改验证（验证通过后状态变为已完成）

### 2.4 评分统计
- 按日期统计平均分
- 按区域统计平均分
- 按检查人员统计平均分
- 评分趋势分析（可选）

### 2.5 排名展示
- 区域排名（按平均分）
- 部门排名（按平均分）
- 排名报表导出

## 3. 数据库设计

### 3.1 5S检查记录表（site_5s_check）

```sql
CREATE TABLE `site_5s_check` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `check_no` varchar(50) NOT NULL COMMENT '检查单号',
  `check_date` date NOT NULL COMMENT '检查日期',
  `check_area` varchar(100) NOT NULL COMMENT '检查区域',
  `checker_name` varchar(50) DEFAULT NULL COMMENT '检查人员',
  -- 5S各项评分（每项满分20分）
  `sort_score` int DEFAULT NULL COMMENT '整理得分（0-20）',
  `set_score` int DEFAULT NULL COMMENT '整顿得分（0-20）',
  `shine_score` int DEFAULT NULL COMMENT '清扫得分（0-20）',
  `standardize_score` int DEFAULT NULL COMMENT '清洁得分（0-20）',
  `sustain_score` int DEFAULT NULL COMMENT '素养得分（0-20）',
  `total_score` int DEFAULT NULL COMMENT '总分（0-100）',
  `problem_description` varchar(1000) DEFAULT NULL COMMENT '问题描述',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_check_no` (`check_no`),
  KEY `idx_check_date` (`check_date`),
  KEY `idx_check_area` (`check_area`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='5S检查记录表';
```

### 3.2 5S整改任务表（site_5s_rectification）

```sql
CREATE TABLE `site_5s_rectification` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `task_no` varchar(50) NOT NULL COMMENT '任务编号',
  `check_id` bigint NOT NULL COMMENT '检查记录ID',
  `problem_description` varchar(1000) NOT NULL COMMENT '问题描述',
  `area` varchar(100) NOT NULL COMMENT '区域',
  `department` varchar(50) DEFAULT NULL COMMENT '责任部门',
  `responsible_person` varchar(50) DEFAULT NULL COMMENT '责任人',
  `deadline` date DEFAULT NULL COMMENT '整改期限',
  `rectification_content` varchar(1000) DEFAULT NULL COMMENT '整改内容',
  `rectification_date` date DEFAULT NULL COMMENT '整改日期',
  `verifier_name` varchar(50) DEFAULT NULL COMMENT '验证人员',
  `verification_date` date DEFAULT NULL COMMENT '验证日期',
  `verification_result` varchar(500) DEFAULT NULL COMMENT '验证结果',
  `status` tinyint DEFAULT 0 COMMENT '状态：0-待整改，1-整改中，2-待验证，3-已完成',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_task_no` (`task_no`),
  KEY `idx_check_id` (`check_id`),
  KEY `idx_status` (`status`),
  KEY `idx_deadline` (`deadline`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='5S整改任务表';
```

### 3.3 区域表（site_area）

```sql
CREATE TABLE `site_area` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `area_code` varchar(50) NOT NULL COMMENT '区域编码',
  `area_name` varchar(100) NOT NULL COMMENT '区域名称',
  `department` varchar(50) DEFAULT NULL COMMENT '负责部门',
  `status` tinyint DEFAULT 1 COMMENT '状态：0-停用，1-启用',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_area_code` (`area_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='区域表';
```

## 4. 开发要点

### 4.1 评分计算
- 总分 = 整理得分 + 整顿得分 + 清扫得分 + 清洁得分 + 素养得分
- 每项得分范围：0-20分
- 总分范围：0-100分

### 4.2 整改任务生成
- 从检查记录中提取问题描述
- 自动生成任务编号
- 设置责任部门和责任人
- 设置整改期限（如：检查日期后7天）

### 4.3 整改状态流转
- 待整改 → 整改中 → 待验证 → 已完成
- 状态更新需要记录操作时间和操作人

### 4.4 统计功能
- 使用SQL聚合函数统计平均分
- 支持按日期、区域、检查人员等维度统计
- 提供排名功能

### 4.5 编号生成
- 检查单号：5SCHECK + 日期 + 序号
- 任务编号：5STASK + 日期 + 序号

## 5. 注意事项

1. 检查单号和任务编号必须唯一
2. 总分自动计算，不需要手动输入
3. 整改任务可以从检查记录中生成，也可以手动创建
4. 删除使用逻辑删除
5. 整改期限到期前需要提醒（可选）
6. 验证通过后，整改任务状态变为已完成
7. 支持排名报表导出功能
8. 5S各项评分需要在表单中进行限制（0-20分）
