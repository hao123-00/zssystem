# Spring Boot DevTools 热部署使用说明

## 已安装的依赖

已在 `pom.xml` 中添加了 `spring-boot-devtools` 依赖，配置如下：

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <scope>runtime</scope>
    <optional>true</optional>
</dependency>
```

## 配置文件

已在 `application.yml` 中添加了 DevTools 配置：

```yaml
spring:
  devtools:
    restart:
      enabled: true
      additional-paths: src/main/java,src/main/resources
      exclude: static/**,public/**,templates/**
    livereload:
      enabled: true
```

## 使用方法

### 1. 重新编译项目

首次使用需要重新编译项目以加载 DevTools 依赖：

```bash
cd /Users/czd/zssystem/backend
mvn clean compile
```

### 2. 启动项目

正常启动项目：

```bash
mvn spring-boot:run
```

或者使用 IDE 运行主类。

### 3. 自动重启机制

DevTools 会监听以下文件的变化，并自动重启应用：

- **Java 类文件** (`src/main/java/**/*.java`)
- **配置文件** (`src/main/resources/**/*`)
- **Maven 依赖变化**

当这些文件发生变化时，应用会自动重启（通常几秒钟内完成）。

### 4. IDE 配置（重要）

为了确保热部署正常工作，需要在 IDE 中启用自动编译：

#### IntelliJ IDEA

1. **启用自动编译**：
   - `File` → `Settings` → `Build, Execution, Deployment` → `Compiler`
   - 勾选 `Build project automatically`

2. **启用运行时自动编译**：
   - `File` → `Settings` → `Advanced Settings`
   - 勾选 `Allow auto-make to start even if developed application is currently running`

3. **快捷键设置**（可选）：
   - `Ctrl + Shift + A` (Windows/Linux) 或 `Cmd + Shift + A` (Mac)
   - 搜索 "Registry"
   - 找到并启用 `compiler.automake.allow.when.app.running`

#### Eclipse

1. **启用自动编译**：
   - `Project` → `Build Automatically`（勾选）

#### VS Code

1. 安装 Java Extension Pack
2. 确保启用了自动保存和自动编译

### 5. 触发重启的方式

以下操作会触发自动重启：

- ✅ 修改 Java 类文件并保存
- ✅ 修改 `application.yml` 等配置文件
- ✅ 修改 Maven 依赖（需要重新编译）
- ❌ 修改静态资源（如 HTML、CSS、JS）不会重启（已配置排除）

### 6. 性能优化

DevTools 使用两个类加载器来加速重启：

- **Base ClassLoader**：加载不会变化的类（如第三方库）
- **Restart ClassLoader**：加载你的应用代码

这样重启时只需要重新加载应用代码，速度会快很多。

### 7. 禁用热部署

如果需要在生产环境禁用，可以在 `application.yml` 中设置：

```yaml
spring:
  devtools:
    restart:
      enabled: false
```

或者通过环境变量：

```bash
export SPRING_DEVTOOLS_RESTART_ENABLED=false
```

## 注意事项

1. **首次启动**：第一次启动时，DevTools 会创建一些缓存文件，可能需要稍等片刻。

2. **编译时间**：自动重启的速度取决于项目大小和编译时间。

3. **数据库连接**：重启时数据库连接会断开并重新建立，确保数据库服务正常运行。

4. **日志输出**：重启时会在控制台看到 "Restarting..." 和 "Restarted" 的日志。

5. **端口占用**：确保 8080 端口没有被其他程序占用。

## 故障排查

如果热部署不工作，请检查：

1. ✅ 是否已重新编译项目（`mvn clean compile`）
2. ✅ IDE 是否启用了自动编译
3. ✅ 是否在开发环境（DevTools 在生产环境默认禁用）
4. ✅ 查看控制台是否有错误信息
5. ✅ 检查 `application.yml` 中的配置是否正确

## 更多信息

- [Spring Boot DevTools 官方文档](https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.devtools)
